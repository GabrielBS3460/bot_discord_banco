datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Usuarios {
  discord_id     String  @id
  nivel_narrador Int     @default(1)
  
  personagens Personagens[]
  
  personagemAtivo   Personagens? @relation("PersonagemAtivo", fields: [personagem_ativo_id], references: [id])
  personagem_ativo_id Int?         @unique 
}

model Personagens {
  id        Int      @id @default(autoincrement()) 
  nome      String   @unique
  saldo     Float    @default(0)

  ultimo_resgate_recompensa DateTime?
  ultimo_resgate_manavitra  DateTime?
  
  jogador    Usuarios @relation(fields: [usuario_id], references: [discord_id])
  usuario_id String  

  transacoes Transacao[]

  utilizadorAtivo Usuarios? @relation("PersonagemAtivo")
}

model Transacao {
  id        Int      @id @default(autoincrement())
  data      DateTime @default(now())
  descricao String
  valor     Float
  tipo      String
  categoria String?

  personagem    Personagens @relation(fields: [personagem_id], references: [id], onUpdate: Cascade)
  personagem_id Int
}
